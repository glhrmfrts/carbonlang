import module

func alloc_slice(type T, size: usize): {[]T, error} {
    let buf, err = cast(&opaque)nil, noerr
    if (err != noerr) {
        return nil, err
    }

    let result = []T{ cast(&T)buf, size }
    return result, noerr
}

func free(p: &opaque) {
}

func free_slice(s) {
    free(s.ptr)
}

extern(C) func carbon_main() : int {
    // let haystack = "Hello world"
    
    // let hello = haystack[2, 5]

// TODO: fix name clash with function
    // let cstat : Stat
    // let size = cstat.st_atime
/*
    let val : {usize, bool} = {0, false}
    let val2 : {usize, bool} = {0, true}

    let eq = val == val2
*/

/*
    let ptr : &{usize, usize}
    @ptr = {cast(usize)0, cast(usize)0}

    takeString("Hello")

    takeString("Hello")

    let values : {usize, {usize, usize}}

    let eq : int
    if (values == {cast(usize)0, {cast(usize)0, cast(usize)0}}) {
        eq = 1
    }
    else {
        eq = 0
    }
*/
    let a, err = alloc_slice(type &pure uint8, 1)
    free_slice(a)

    let b, err = alloc_slice(type &pure int32, 1)
    free_slice(b)

    //let b, err = alloc_slice(type &pure uint8, 1)
    //free_slice(b)
}